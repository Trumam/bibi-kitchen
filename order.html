<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
    <title>ğŸ‘©â€ğŸ³ğŸŒŸ å¥‡é’é£Ÿå ‚ Â· ç‚¹èœOrder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, sans-serif;
        }
        body {
            background: #fef3e4;
            padding: 16px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 32px;
            padding: 24px 20px;
            box-shadow: 0 8px 20px rgba(185,91,61,0.1);
            border: 1px solid #ffd9b5;
        }
        h1 {
            color: #b85b3a;
            font-size: 32px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-left: 8px solid #ff9933;
            padding-left: 16px;
        }
        .sub {
            color: #8a6e5b;
            margin-bottom: 24px;
            font-size: 18px;
            padding-left: 24px;
        }
        .category {
            font-size: 24px;
            font-weight: bold;
            color: #6b4a36;
            margin-top: 24px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 3px solid #ffccaa;
        }
        .dish-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: #fff9f2;
            border-radius: 30px;
            margin-bottom: 12px;
            border: 1px solid #ffe8da;
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
        }
        .dish-name {
            font-size: 22px;
            font-weight: 600;
            color: #4d3427;
            flex: 1;
        }
        .order-btn {
            background: #b85b3a;
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 40px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 0 #7e3e28;
            cursor: pointer;
            transition: 0.1s;
        }
        .order-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #7e3e28;
        }
        .cart-area {
            background: #fff3e9;
            border-radius: 24px;
            padding: 24px;
            margin-top: 30px;
        }
        .cart-title {
            font-size: 22px;
            font-weight: bold;
            color: #5a3f31;
            margin-bottom: 16px;
        }
        .selected-dish {
            background: white;
            padding: 14px 20px;
            border-radius: 40px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #ffc7a0;
        }
        .remove-btn {
            color: #999;
            font-size: 24px;
            background: none;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .input-field {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid #ffd9bf;
            border-radius: 50px;
            font-size: 18px;
            margin: 16px 0;
            background: white;
        }
        .submit-btn {
            width: 100%;
            background: #b85b3a;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 50px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 6px 0 #7e3e28;
            cursor: pointer;
            transition: 0.1s;
        }
        .submit-btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #7e3e28;
        }
        .empty-cart {
            padding: 30px;
            text-align: center;
            color: #9b7b67;
            font-size: 18px;
        }
        .no-menu {
            text-align: center;
            padding: 50px 20px;
            color: #a28e7c;
            font-size: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1> ğŸ‘©â€ğŸ³ğŸŒŸ å¥‡é’é£Ÿå ‚</h1>
    <div class="sub">â€”â€” å®¶çš„å‘³é“ï¼Œå°å¨ä¸Šçº¿</div>
    
    <!-- èœå•å®¹å™¨ -->
    <div id="menuContainer"></div>
    <div id="noMenuMsg" class="no-menu" style="display:none;">
        ğŸ¥¢ å°é£Ÿå ‚æ­£åœ¨æ›´æ–°èœå•ï¼Œç¨ç­‰å†æ¥ç‚¹èœå§ï½
    </div>
    
    <!-- ç‚¹é¤åŒºåŸŸ -->
    <div class="cart-area">
        <div class="cart-title">ğŸ›’ æ‚¨ç‚¹çš„èœ</div>
        <div id="cartList"></div>
        
        <input type="text" class="input-field" id="customerName" placeholder="æ‚¨çš„ç§°å‘¼ï¼ˆå¦‚ï¼šå¥‡é’ï¼‰">
        
        <button class="submit-btn" onclick="submitOrder()">ğŸ“² ç‚¹å‡»ä¸‹å•</button>
    </div>
</div>

<script>
    // ========== è´­ç‰©è½¦ ==========
    let cart = [];
    
    // ========== ä»å¥‡é’é‚£è¾¹è¯»å–èœå• ==========
    function loadMenu() {
        const savedMenu = localStorage.getItem('nainai_menu');
        if (savedMenu) {
            return JSON.parse(savedMenu);
        }
        return [];  // æ²¡æœ‰èœå•å°±è¿”å›ç©ºæ•°ç»„
    }
    
    // ========== è¯»å–åˆ†ç±» ==========
    function loadCategories() {
        const savedCats = localStorage.getItem('nainai_categories');
        if (savedCats) {
            return JSON.parse(savedCats);
        }
        return ['è‚‰ç±»', 'èœç±»', 'é¥®æ–™', 'ç”œå“'];  // é»˜è®¤åˆ†ç±»
    }
    
    // ========== æ¸²æŸ“èœå• ==========
    function renderMenu() {
        const menu = loadMenu();
        const categories = loadCategories();
        const container = document.getElementById('menuContainer');
        const noMenuMsg = document.getElementById('noMenuMsg');
        
        if (menu.length === 0) {
            container.innerHTML = '';
            noMenuMsg.style.display = 'block';
            return;
        }
        
        noMenuMsg.style.display = 'none';
        
        let html = '';
        
        // æŒ‰åˆ†ç±»æ˜¾ç¤º
        categories.forEach(cat => {
            const dishesInCat = menu.filter(dish => dish.category === cat);
            if (dishesInCat.length === 0) return;
            
            html += `<div class="category">${cat}</div>`;
            
            dishesInCat.forEach(dish => {
                html += `
                    <div class="dish-item">
                        <span class="dish-name">${dish.name}</span>
                        <button class="order-btn" onclick="addToCart('${dish.name}')">ç‚¹è¿™ä¸ª</button>
                    </div>
                `;
            });
        });
        
        container.innerHTML = html;
    }
    
    // ========== è´­ç‰©è½¦æ“ä½œ ==========
    window.addToCart = function(dishName) {
        cart.push(dishName);
        renderCart();
    };
    
    window.removeFromCart = function(index) {
        cart.splice(index, 1);
        renderCart();
    };
    
    function renderCart() {
        const cartList = document.getElementById('cartList');
        if (!cartList) return;
        
        if (cart.length === 0) {
            cartList.innerHTML = '<div class="empty-cart">ğŸ›’ è¿˜æ²¡æœ‰ç‚¹èœï¼Œç‚¹ä¸Šé¢çš„ã€ç‚¹è¿™ä¸ªã€‘åŠ èœ</div>';
            return;
        }
        
        let html = '';
        cart.forEach((dish, index) => {
            html += `
                <div class="selected-dish">
                    <span style="font-size:20px; font-weight:600;">${dish}</span>
                    <button class="remove-btn" onclick="removeFromCart(${index})">âœ•</button>
                </div>
            `;
        });
        cartList.innerHTML = html;
    }
    
    // ========== æäº¤è®¢å• ==========
    window.submitOrder = function() {
        const customer = document.getElementById('customerName').value.trim();
        
        if (cart.length === 0) {
            alert('è¿˜æ²¡æœ‰ç‚¹èœå‘¢');
            return;
        }
        
        if (customer === '') {
            alert('è¯·å¡«ä¸Šæ‚¨çš„ç§°å‘¼ï¼Œé£Ÿå ‚æ‰çŸ¥é“æ˜¯è°ç‚¹çš„');
            return;
        }
        
        // ç”Ÿæˆè®¢å•
        const order = {
            person: customer,
            items: [...cart],
            time: new Date().toLocaleString('zh-CN', {hour12: false})
        };
        
        // è¯»å–ç°æœ‰è®¢å•
        let orders = [];
        const savedOrders = localStorage.getItem('nainai_orders');
        if (savedOrders) {
            orders = JSON.parse(savedOrders);
        }
        
        // æ·»åŠ æ–°è®¢å•
        orders.unshift(order);
        
        // ä¿å­˜
        localStorage.setItem('nainai_orders', JSON.stringify(orders));
        
        // æ¸…ç©ºè´­ç‰©è½¦
        cart = [];
        document.getElementById('customerName').value = '';
        renderCart();
        
        alert('âœ… ä¸‹å•æˆåŠŸï¼é£Ÿå ‚æ”¶åˆ°å•¦');
    };
    
    // ========== å®šæ—¶åˆ·æ–°èœå•ï¼ˆé£Ÿå ‚æ›´æ–°äº†ï¼Œå­©å­è¿™è¾¹é©¬ä¸Šèƒ½çœ‹åˆ°ï¼‰ ==========
    function startAutoRefresh() {
        renderMenu();  // å…ˆæ¸²æŸ“ä¸€æ¬¡
        
        // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡èœå•æœ‰æ²¡æœ‰å˜åŒ–
        setInterval(function() {
            renderMenu();
        }, 3000);
    }
    
    // ========== å¯åŠ¨ ==========
    window.onload = function() {
        startAutoRefresh();
        renderCart();
    };
</script>
</body>
</html>